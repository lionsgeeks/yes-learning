import{K as ye,m as we,r as n,j as e,L as Ce}from"./app-Dd7Q8jNu.js";import{E as Q,A as De,a as Le,b as Se,c as Te,d as Fe,e as ke,f as Ae,g as Me}from"./alert-dialog-kj543Teu.js";import{B as c}from"./button-KjDgFd1P.js";import{C as U,a as Ee,b as Ve,d as q}from"./card-CfFIHGbB.js";import{D as K,a as X,b as Y,c as Z,e as Ie,d as G}from"./dialog-C3xIbq3o.js";import{A as Oe,D as J,a as W,b as ee,f as se,c as u,g as ae}from"./app-layout-BA-I2_TL.js";import{I as o}from"./input-CKZp8rp8.js";import{L as m}from"./label-MZ4qcrcX.js";import{S as ze}from"./scroll-area-C10NkM8m.js";import{T as Be,a as He,b as N,c as F,d as Re,e as h}from"./table-Cp9imxb6.js";import{T as ie,c as y,a as _e,b as k}from"./tabs-CsNbqTkm.js";import{S as $e}from"./search-BITuWlit.js";import{F as Pe}from"./filter-DTYVaY3-.js";import{C as Qe}from"./chevron-down-BhKfBWad.js";import{C as Ue}from"./index-jda3ngqe.js";import{E as le}from"./eye-BcWaCIQa.js";import{S as te}from"./square-pen-DqKF4WDo.js";import{T as w}from"./trash-2-hZfra-Ye.js";import{F as qe}from"./file-text-CH7zLvRt.js";import{L as Ke}from"./layers-CGeQ1QZH.js";import{C as Xe}from"./clock-DOmT8OHk.js";import{F as Ye}from"./file-Cth1ZqMk.js";import"./index-Clufub-a.js";import"./index-CJnyyRVE.js";import"./index-DiPPBe7i.js";import"./book-open-5AuiOLw1.js";import"./index-BdQq_4o_.js";const Ze=[{title:"Libraries",href:"/admin/libraries"}];function Cs(){var B,H,R,_,$;const{libraries:re}=ye().props,{data:r,setData:d,delete:A,post:ne,reset:C,processing:p}=we(),[f,ce]=n.useState(""),[de,D]=n.useState(!1),[x,M]=n.useState(null),[L,g]=n.useState(!1),[i,E]=n.useState(null),[j,V]=n.useState([]),[oe,b]=n.useState(!1),[l,me]=n.useState(null),[he,xe]=n.useState("all");n.useEffect(()=>{L&&i&&(d({...i}),C(i.isMainLibrary?{title:i.title}:{title:i.title,coach:i.coach,link:i.link,documents:i.filelibraries}))},[L,i,C]),console.log("library to edit ",i);const ue=()=>{x&&A(route(x.isMainLibrary?"library.destroy":"sublibrary.destroy",{id:x.id}),{onSuccess:()=>{D(!1),M(null)}})};function je(s){const a=/(?:https?:\/\/(?:www\.)?youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=))([^"&?/]+)/,t=s.match(a);return t&&t[1]}const pe=()=>{i&&ne(route(i.isMainLibrary?"library.update":"sublibrary.update",{_method:"put",data:i,...i.isMainLibrary?{library:i.id}:{sublibrary:i.id}}),{onSuccess:()=>g(!1),preserveScroll:!0})},S=(s,a,t)=>{d(s,{...r[s],[a]:t})},I=re.filter(s=>s.title.en.toLowerCase().includes(f.toLowerCase())||s.title.ar.toLowerCase().includes(f.toLowerCase())||s.title.fr.toLowerCase().includes(f.toLowerCase())),fe=s=>{j.includes(s)?V(j.filter(a=>a!==s)):V([...j,s])},O=(s,a,t)=>{M({id:s,isMainLibrary:a,parentId:t}),D(!0)},T=(s,a,t)=>{E({...s,isMainLibrary:a,parentId:t}),C(a?{title:s.title}:{title:s.title,coach:s.coach,link:s.link}),g(!0)},z=(s,a)=>{me({...s,isMainLibrary:a}),b(!0)},ge=s=>{const a=Array.from(s.target.files),t=10*1024*1024,Ne=["application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],P=a.filter(v=>Ne.includes(v.type)?v.size>t?(alert(`File too large (max 10MB): ${v.name}`),!1):!0:(alert(`Invalid file type: ${v.name}`),!1));console.log("documents : ",P),d("documents",[...r.documents||[],...P])},be=s=>{A(route("file.delete",{id:s}),{onSuccess:()=>{E(a=>({...a,filelibraries:a.filelibraries.filter(t=>t.id!==s)}))}})},ve=s=>{d("documents",r.documents.filter((a,t)=>t!==s))};return e.jsxs(Oe,{breadcrumbs:Ze,children:[e.jsx(Ce,{title:"Libraries"}),e.jsxs("div",{className:"p-3 lg:p-6",children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Library Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Organize and manage your educational content library"})]})}),e.jsxs(ie,{defaultValue:"all",value:he,onValueChange:xe,children:[e.jsx("div",{className:"mb-4 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"text-muted-foreground absolute top-2.5 left-2.5 h-4 w-4"}),e.jsx(o,{type:"search",placeholder:"Search libraries...",className:"w-full pl-9 sm:w-[260px]",value:f,onChange:s=>ce(s.target.value)})]}),e.jsxs(c,{variant:"outline",size:"icon",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Filter"})]})]})}),e.jsx(y,{value:"all",className:"mt-0",children:e.jsxs(U,{children:[e.jsx(Ee,{className:"pb-3",children:e.jsx(Ve,{children:"Libraries"})}),e.jsx(q,{children:e.jsxs(Be,{children:[e.jsx(He,{children:e.jsxs(N,{children:[e.jsx(F,{className:"w-12"}),e.jsx(F,{children:"Library"}),e.jsx(F,{className:"text-right",children:"Actions"})]})}),e.jsx(Re,{children:I.length===0?e.jsx(N,{children:e.jsx(h,{colSpan:7,className:"text-muted-foreground py-8 text-center",children:"No libraries found. Try adjusting your search."})}):I.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(N,{className:"bg-muted/30",children:[e.jsx(h,{children:e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>fe(s.id),className:"h-8 w-8",children:j.includes(s.id)?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})})}),e.jsx(h,{children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{children:e.jsx("p",{className:"font-medium",children:s.title.en})})})}),e.jsx(h,{className:"text-right",children:e.jsxs(J,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(c,{variant:"ghost",size:"icon",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(ee,{align:"end",children:[e.jsx(se,{children:"Actions"}),e.jsxs(u,{onClick:()=>z(s,!0),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"View Details"]}),e.jsxs(u,{onClick:()=>T(s,!0),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(ae,{}),e.jsxs(u,{className:"text-destructive",onClick:()=>O(s.id,!0),children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id),j.includes(s.id)&&s.sublibraries.map(a=>e.jsxs(N,{className:"bg-background",children:[e.jsx(h,{}),e.jsx(h,{children:e.jsx("div",{className:"border-primary/20 flex items-center gap-3 border-l-2 pl-6",children:e.jsx("div",{children:e.jsx("p",{className:"font-medium",children:a.title})})})}),e.jsx(h,{className:"text-right",children:e.jsxs(J,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(c,{variant:"ghost",size:"icon",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(ee,{align:"end",children:[e.jsx(se,{children:"Actions"}),e.jsxs(u,{onClick:()=>z(a,!1),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"View Content"]}),e.jsxs(u,{onClick:()=>T(a,!1,s.id),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(ae,{}),e.jsxs(u,{className:"text-destructive",onClick:()=>O(a.id,!1,s.id),children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},`sub-${a.id}`))]}))})]})})]})})]}),e.jsx(De,{open:de,onOpenChange:D,children:e.jsxs(Le,{children:[e.jsxs(Se,{children:[e.jsx(Te,{children:"Are you sure?"}),e.jsx(Fe,{children:x!=null&&x.isMainLibrary?"This will permanently delete this library and all its sub-libraries. This action cannot be undone.":"This will permanently delete this sub-library. This action cannot be undone."})]}),e.jsxs(ke,{children:[e.jsx(Ae,{children:"Cancel"}),e.jsx(Me,{onClick:ue,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:p,children:p?"Deleting...":"Delete"})]})]})}),e.jsx(K,{open:L,onOpenChange:g,children:e.jsxs(X,{className:"sm:max-w-[525px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:i!=null&&i.isMainLibrary?"Edit Main Library":"Edit Sub-Library"}),e.jsx(Ie,{children:"Make changes to the library details below."})]}),i&&e.jsx("div",{className:"grid gap-4 py-4",children:i.isMainLibrary?e.jsxs(ie,{defaultValue:"en",children:[e.jsxs(_e,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"en",children:"English"}),e.jsx(k,{value:"fr",children:"French"}),e.jsx(k,{value:"ar",children:"Arabic"})]}),e.jsx(y,{value:"en",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title.en",children:"Title (English)"}),e.jsx(o,{id:"title.en",value:((B=r.title)==null?void 0:B.en)||"",onChange:s=>S("title","en",s.target.value)})]})}),e.jsx(y,{value:"fr",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title.fr",children:"Title (French)"}),e.jsx(o,{id:"title.fr",value:((H=r.title)==null?void 0:H.fr)||"",onChange:s=>S("title","fr",s.target.value)})]})}),e.jsx(y,{value:"ar",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title.ar",children:"Title (Arabic)"}),e.jsx(o,{id:"title.ar",value:((R=r.title)==null?void 0:R.ar)||"",onChange:s=>S("title","ar",s.target.value)})]})})]}):e.jsxs(ze,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"coach",children:"Title"}),e.jsx(o,{id:"title",value:r.title||"",onChange:s=>d("title",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"coach",children:"Coach"}),e.jsx(o,{id:"coach",value:r.coach||"",onChange:s=>d("coach",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"youtubeId",children:"YouTube Video ID"}),e.jsx(o,{id:"youtubeId",value:r.link||"",onChange:s=>d("link",je(s.target.value))})]}),((_=r.filelibraries)==null?void 0:_.length)>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Selected Files:"}),e.jsx("ul",{className:"text-muted-foreground space-y-1 text-sm",children:r.filelibraries.map((s,a)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.name}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>be(s.id),children:e.jsx(w,{className:"h-4 w-4"})})]},a))})]}),(($=r.documents)==null?void 0:$.length)>0&&e.jsx("ul",{className:"text-muted-foreground space-y-1 text-sm",children:r.documents.map((s,a)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.name}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ve(a),children:e.jsx(w,{className:"h-4 w-4"})})]},a))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Documents"}),e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-md border-2 border-dashed p-6",children:[e.jsx("div",{className:"text-muted-foreground mb-4",children:e.jsx(qe,{className:"h-12 w-12"})}),e.jsxs("div",{className:"text-muted-foreground flex text-sm",children:[e.jsxs("label",{htmlFor:"pdf-upload",className:"text-primary focus-within:ring-primary relative cursor-pointer rounded-md font-medium focus-within:ring-2 focus-within:outline-none",children:[e.jsx("span",{children:"Upload a PDF"}),e.jsx("input",{multiple:!0,id:"pdf-upload",name:"pdf-upload",type:"file",accept:".pdf,.xls,.xlsx",className:"sr-only",onChange:s=>ge(s)})]}),e.jsx("p",{className:"pl-1",children:"or enter URL"})]}),e.jsx("p",{className:"text-muted-foreground mt-2 text-xs",children:"PDF up to 50MB"})]})]})]})}),e.jsxs(G,{children:[e.jsx(c,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(c,{onClick:pe,disabled:p,children:p?"Saving...":"Save changes"})]})]})}),e.jsx(K,{open:oe,onOpenChange:b,children:e.jsx(X,{className:"max-h-[80vh] overflow-y-auto sm:max-w-[700px]",children:l&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsx(Z,{children:l.isMainLibrary?"Library Details":"Sub-Library Content"})}),e.jsx("div",{className:"mt-4 space-y-6",children:l.isMainLibrary?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row",children:e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:l.title.en}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{className:"text-muted-foreground mr-1 h-4 w-4"}),e.jsxs("span",{children:[l.sublibraries.length," sub-libraries"]})]})})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Sub-Libraries"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:l.sublibraries.map(s=>e.jsx(U,{className:"overflow-hidden",children:e.jsx("div",{className:"flex",children:e.jsxs(q,{className:"flex-1 p-3",children:[e.jsx("h5",{className:"line-clamp-1 font-medium",children:s.title}),e.jsxs("div",{className:"text-muted-foreground mt-1 flex items-center text-xs",children:[e.jsx(Xe,{className:"mr-1 h-3 w-3"}),s.duration,e.jsx("span",{className:"mx-1",children:"â€¢"}),s.coach]})]})})},s.id))})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted flex aspect-video w-full items-center justify-center overflow-hidden rounded-md",children:l.link?e.jsx("iframe",{src:`https://www.youtube.com/embed/${l.link}`,title:l.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"h-full w-full"}):e.jsx("p",{className:"text-2xl text-black",children:"No video provided"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xl font-semibold",children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Coach:"}),e.jsx("span",{className:"font-medium",children:l.coach})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Documents"}),e.jsx("div",{className:"space-y-3",children:l.filelibraries.map((s,a)=>e.jsx("div",{className:"hover:bg-muted/50 flex items-center justify-between rounded-md border p-3 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-primary/10 mr-3 flex h-10 w-10 items-center justify-center rounded",children:e.jsx(Ye,{className:"text-primary h-5 w-5"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium",children:s.name})})]})},a))})]})]})})}),e.jsxs(G,{children:[e.jsx(c,{variant:"outline",onClick:()=>b(!1),children:"Close"}),e.jsx(c,{onClick:()=>{b(!1),T(l,l.isMainLibrary,l.isMainLibrary?void 0:l.parentId)},children:"Edit"})]})]})})})]})]})}export{Cs as default};
